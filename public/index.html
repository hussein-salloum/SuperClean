<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SuperClean ‚Äì Menu</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/public/style.css">
</head>
<body>
  <header>
    <img src="/public/logo.png" alt="Company Logo">
  </header>

  <div class="container">
    <div class="filter-buttons">
      <button class="active" onclick="filterItems('all', this)">All</button>
      <button onclick="filterItems('3.7L', this)">3.7 L</button>
      <button onclick="filterItems('1L', this)">1 L</button>
    </div>

    <div class="product-grid" id="productGrid"></div>
  </div>

  <footer>
    Designed with üíß by <strong>SuperClean</strong>
  </footer>

  <!-- Floating Calculator Button -->
  <button id="open-calculator" class="calculator-btn">üßÆ</button>

  <!-- Calculator Modal -->
  <div id="calculator-modal" class="modal">
    <div class="modal-content calculator-box">
      <span class="close calc-close">&times;</span>
      <h2>üßæ Your Calculator</h2>
      <div id="calc-items"></div>
      <div id="calc-total">Total: $0.00</div>
    </div>
  </div>

  <script>
    let items = [];
    let cart = [];

    function fetchItems() {
      fetch('/api/items')
        .then(res => res.json())
        .then(data => {
          items = data;
          renderItems('all');
        });
    }

    function renderItems(category) {
      const grid = document.getElementById('productGrid');
      grid.innerHTML = '';
      items.forEach(it => {
        if (category === 'all' || it.category === category) {
          const card = document.createElement('div');
          card.className = 'product-card';
          card.innerHTML = `
            <img src="${it.image}" alt="${it.name}">
            <div class="product-info">
              <div class="product-name">${it.name}</div>
              <div class="product-desc">${it.description || "No description available."}</div>
              <div class="product-price">${it.price} $</div>
            </div>
          `;
          card.addEventListener('click', () => addToCalculator(it));
          grid.appendChild(card);
        }
      });
    }

    function filterItems(cat, btn) {
      document.querySelectorAll('.filter-buttons button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      renderItems(cat);
    }

    // ---------- Calculator Logic ----------
    function addToCalculator(product) {
      const existing = cart.find(item => item.name === product.name);
      if (existing) {
        existing.qty += 1;
      } else {
        cart.push({ ...product, qty: 1, price: Number(product.price) });
      }
      updateCalculator();
    }

   function updateCalculator() {
  const calcList = document.getElementById('calc-items');
  const calcTotal = document.getElementById('calc-total');
  calcList.innerHTML = '';

  let total = 0;
  cart.forEach((item, index) => {
    const subtotal = item.price * item.qty;
    total += subtotal;

    const row = document.createElement('div');
    row.className = 'calc-item';
    row.innerHTML = `
      <div class="calc-info">
        <strong>${item.name}</strong><br>
        <span class="price-line">$${item.price.toFixed(2)} each</span>
      </div>
      <div class="calc-controls">
        <button class="qty-btn" data-index="${index}" data-action="dec">‚Äì</button>
        <input type="number" min="1" value="${item.qty}" data-index="${index}">
        <button class="qty-btn" data-index="${index}" data-action="inc">+</button>
        <span class="subtotal">$${subtotal.toFixed(2)}</span>
        <button class="delete-btn" data-index="${index}" title="Remove">üóëÔ∏è</button>
      </div>
    `;
    calcList.appendChild(row);
  });

  calcTotal.textContent = `Total: $${total.toFixed(2)}`;
}

    // Quantity changes
    document.addEventListener('click', e => {
      if (e.target.matches('.qty-btn')) {
        const index = e.target.dataset.index;
        const action = e.target.dataset.action;
        if (action === 'inc') cart[index].qty++;
        if (action === 'dec' && cart[index].qty > 1) cart[index].qty--;
        updateCalculator();
      }
    });

    document.addEventListener('input', e => {
      if (e.target.matches('#calc-items input[type="number"]')) {
        const index = e.target.dataset.index;
        const newQty = parseInt(e.target.value) || 1;
        cart[index].qty = newQty;
        updateCalculator();
      }
    });

    // Open & close calculator modal
    document.getElementById('open-calculator').addEventListener('click', () => {
      document.getElementById('calculator-modal').style.display = 'block';
    });

    document.querySelector('.calc-close').addEventListener('click', () => {
      document.getElementById('calculator-modal').style.display = 'none';
    });

    window.addEventListener('click', e => {
      if (e.target == document.getElementById('calculator-modal')) {
        document.getElementById('calculator-modal').style.display = 'none';
      }
    });

    // Delete item from calculator
document.addEventListener('click', e => {
  if (e.target.matches('.delete-btn')) {
    const index = e.target.dataset.index;
    cart.splice(index, 1);
    updateCalculator();
  }
});

    fetchItems();
  </script>
</body>
</html>
